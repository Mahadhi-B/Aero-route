<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aero-Route - Road-Aligned</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body { font-family: 'Segoe UI', sans-serif; text-align:center; margin:0; padding:0; background:linear-gradient(to bottom right, #e0f7fa,#ffffff);}
  h1 { color:#00796b; margin:20px; text-shadow:1px 1px 2px #aaa;}
  .controls { background:#ffffffcc; display:inline-block; padding:15px 25px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.15); margin-bottom:10px;}
  select, button { padding:10px 16px; font-size:14px; border-radius:8px; border:1px solid #00796b; margin:5px; outline:none; cursor:pointer; transition: all 0.3s;}
  select { min-width:180px; background:#e0f2f1; color:#004d40; }
  button { background:#00796b; color:#fff; font-weight:bold; border:none; }
  button:hover { background:#004d40; transform:scale(1.05);}
  #map { height:70vh; width:90%; max-width:1200px; margin:20px auto; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.25); border:2px solid #00796b;}
  @media(max-width:600px){ select,button{width:80%; margin:8px 0;} .controls{padding:12px 15px;}}
</style>
</head>
<body>

<h1>üåç Aero-Route Road-Aligned</h1>
<p>Select a city pair to see best route based on AQI</p>

<div class="controls">
  <select id="routeSelect">
    <option value="delhi-agra">Delhi ‚Üí Agra</option>
    <option value="madurai-bangalore">Madurai ‚Üí Bangalore</option>
    <option value="bangalore-ap">Bangalore ‚Üí AP</option>
  </select>
  <button onclick="loadRoute()">Show Routes</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([20.0,78.0],5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'¬© OpenStreetMap'
}).addTo(map);

// Simulated AQI function
function getRandomAQI(){ return Math.floor(Math.random()*100)+30; }

// Hardcoded city pairs coordinates
const cityPairs = {
  "delhi-agra": [[77.2090,28.6139],[78.0081,27.1767]],
  "madurai-bangalore": [[78.1198,9.9252],[77.5946,12.9716]],
  "bangalore-ap": [[77.5946,12.9716],[79.0,15.0]]
};

// OSRM fetch function for a route
async function fetchOSRMRoute(start,end){
    const url=`https://router.project-osrm.org/route/v1/driving/${start[0]},${start[1]};${end[0]},${end[1]}?overview=full&geometries=geojson`;
    const res=await fetch(url);
    const data=await res.json();
    if(!data.routes || !data.routes.length) throw "No route from OSRM";
    return data.routes[0].geometry.coordinates.map(c=>[c[1],c[0]]); // Flip lat/lng for Leaflet
}

// Load routes for selected city pair
async function loadRoute(){
    const key=document.getElementById("routeSelect").value;
    const coords=cityPairs[key];

    // Clear previous layers
    map.eachLayer(l=>{ if(l instanceof L.Polyline || l instanceof L.Marker) map.removeLayer(l); });

    // For demo, we create 3 "alternative routes" by slightly altering start/end (just for demo)
    const altOffsets=[[0,0],[0.05,0.05],[-0.05,-0.05]];
    const routes=[];

    for(const offset of altOffsets){
        const start=[coords[0][0]+offset[0],coords[0][1]+offset[1]];
        const end=[coords[1][0]+offset[0],coords[1][1]+offset[1]];
        try{
            const routeCoords=await fetchOSRMRoute(start,end);
            const avgAQI=Math.round(routeCoords.reduce((sum,c)=>sum+getRandomAQI(),0)/routeCoords.length);
            routes.push({coords:routeCoords, avgAQI});
        }catch(e){ console.error(e); }
    }

    // Sort by AQI -> best route first
    routes.sort((a,b)=>a.avgAQI-b.avgAQI);
    const bestRoute=routes[0];

    // Draw routes
    routes.forEach(r=>{
        const color=r===bestRoute ? "green" : "orange";
        const line=L.polyline(r.coords,{color,weight:6,opacity:0.7}).addTo(map);
        line.bindPopup(`Avg AQI: ${r.avgAQI}`);
    });

    // Markers
    L.marker(bestRoute.coords[0]).addTo(map).bindPopup("Start");
    L.marker(bestRoute.coords[bestRoute.coords.length-1]).addTo(map).bindPopup("End");

    map.fitBounds(bestRoute.coords);
}
</script>

</body>
</html>
